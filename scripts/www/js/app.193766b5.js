(function(){"use strict";var e={614:function(e,t,s){var r=s(5471),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("nav",{staticClass:"navbar"},[t("div",{staticClass:"nav-container"},[t("h1",{staticClass:"nav-title"},[e._v("项目管理系统")]),t("div",{staticClass:"nav-menu"},[t("router-link",{staticClass:"nav-link",attrs:{to:"/submission"}},[e._v("提交页面")]),t("router-link",{staticClass:"nav-link",attrs:{to:"/offline"}},[e._v("离线数据")])],1)])]),t("main",{staticClass:"main-content"},[t("router-view")],1)])},o=[],a=s(5353),i=(s(4114),s(8111),s(2489),s(3790)),c=s.n(i);const l="project_management_db",u=c().createInstance({name:l}),d={PROCESS_LIST:"process_list",OFFLINE_RECORDS:"offline_records"},f=async e=>{try{await u.setItem(d.PROCESS_LIST,e)}catch(t){console.error("Error caching process list:",t)}},m=async()=>{try{return await u.getItem(d.PROCESS_LIST)}catch(e){return console.error("Error getting cached process list:",e),null}},p=async e=>{try{const t=await u.getItem(d.OFFLINE_RECORDS)||[];t.push({...e,_offlineId:Date.now().toString()}),await u.setItem(d.OFFLINE_RECORDS,t)}catch(t){console.error("Error saving offline record:",t)}},h=async()=>{try{return await u.getItem(d.OFFLINE_RECORDS)||[]}catch(e){return console.error("Error getting offline records:",e),[]}},v=async e=>{try{const t=await u.getItem(d.OFFLINE_RECORDS)||[],s=t.filter(t=>t._offlineId!==e);await u.setItem(d.OFFLINE_RECORDS,s)}catch(t){console.error("Error removing offline record:",t)}},g=async()=>{try{await u.removeItem(d.OFFLINE_RECORDS)}catch(e){console.error("Error clearing offline records",e)}};s(1701);var y=s(4335);const b=y.A.create({baseURL:"/api/dingtalk",timeout:1e4}),O="dingcbegiem6y2qygmn1",w="DvxWYGUvfLdB3Q2Xchyz7OQwOHxU-GmLE_jv64xe9ZyJvZnDHrnkx1fLmeBGfTCB",S=async()=>{try{const e=await b.post("/v1.0/oauth2/accessToken",{appKey:O,appSecret:w});return e.data}catch(e){throw console.error("Failed to get access token:",e),e}},_=async e=>{try{const t="/v1.0/notable/bases/YndMj49yWjPv69r0T22xeqmEJ3pmz5aA/sheets/5yOQbU0/records/list?operatorId=cmkDNstii4Iii2T4vgRiP61JgiEiE",s=await b.post(t,{maxResults:100,nextToken:""},{headers:{"x-acs-dingtalk-access-token":e}});return s.data}catch(t){throw console.error("Failed to get process list:",t),t}},k=e=>e&&e.records?e.records.map(e=>({id:e.id,name:e.fields["工序名称"]})):[],E=async e=>new Promise((t,s)=>{setTimeout(()=>{console.log("Uploading record:",e),t({success:!0})},1e3)});var I={name:"App",created(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.updateOnlineStatus),this.updateOnlineStatus()},beforeDestroy(){window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.updateOnlineStatus)},methods:{...(0,a.i0)(["updateOnlineStatus"]),handleOnline(){this.updateOnlineStatus(),this.checkAndUploadOfflineRecords()},updateOnlineStatus(){this.$store.dispatch("updateOnlineStatus",navigator.onLine)},async checkAndUploadOfflineRecords(){const e=await h();if(e.length>0){this.$notify.info({title:"网络已连接",message:`发现 ${e.length} 条离线数据，正在自动上传...`});let s=0;for(const r of e)try{await E(r),await v(r._offlineId),s++}catch(t){console.error("Auto upload failed for record:",r,t)}s>0&&this.$notify.success({title:"自动上传完成",message:`成功上传 ${s} 条数据`})}}}},L=I,R=s(1656),T=(0,R.A)(L,n,o,!1,null,null,null),C=T.exports,x=s(3723);(0,x.k)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var N=s(173),$=function(){var e=this,t=e._self._c;return t("div",{staticClass:"submission-container"},[t("h2",[e._v("项目提交")]),t("div",{staticClass:"status-bar"},[e._v(" 当前状态: "),t("el-tag",{attrs:{type:e.isOnline?"success":"danger"}},[e._v(e._s(e.isOnline?"在线":"离线"))])],1),t("el-form",{ref:"form",staticClass:"submission-form",attrs:{model:e.form,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"项目名称"}},[t("el-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.form.projectName,callback:function(t){e.$set(e.form,"projectName",t)},expression:"form.projectName"}})],1),t("el-form-item",{attrs:{label:"所处阶段"}},[t("el-input",{attrs:{placeholder:"请输入所处阶段"},model:{value:e.form.stage,callback:function(t){e.$set(e.form,"stage",t)},expression:"form.stage"}})],1),t("el-form-item",{attrs:{label:"关联施工工序"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择工序"},model:{value:e.form.processId,callback:function(t){e.$set(e.form,"processId",t)},expression:"form.processId"}},e._l(e.processList,function(e){return t("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),t("el-form-item",{attrs:{label:"风险项"}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入风险项"},model:{value:e.form.risks,callback:function(t){e.$set(e.form,"risks",t)},expression:"form.risks"}})],1),t("el-form-item",{attrs:{label:"状态确认"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[t("el-option",{attrs:{label:"未确认",value:"未确认"}}),t("el-option",{attrs:{label:"已确认",value:"已确认"}}),t("el-option",{attrs:{label:"不涉及",value:"不涉及"}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")]),t("el-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1)},F=[],j=(s(116),{name:"Submission",data(){return{form:{projectName:"",stage:"",processId:"",risks:"",status:"未确认"}}},computed:{...(0,a.L8)(["isOnline","processList"])},created(){this.fetchProcessList()},methods:{...(0,a.i0)(["fetchProcessList"]),async onSubmit(){if(!this.form.projectName)return void this.$message.warning("请输入项目名称");const e={...this.form,processName:this.getProcessName(this.form.processId),timestamp:(new Date).toISOString()};if(this.isOnline)try{await E(e),this.$message.success("提交成功 (在线模式)"),this.resetForm()}catch(t){this.$message.error("提交失败，已转存为离线数据"),await this.saveOffline(e)}else await this.saveOffline(e)},async saveOffline(e){await p(e),this.$message.warning("当前处于离线模式，数据已保存到本地"),this.resetForm()},getProcessName(e){const t=this.processList.find(t=>t.id===e);return t?t.name:""},resetForm(){this.form={projectName:"",stage:"",processId:"",risks:"",status:"未确认"}}}}),A=j,P=(0,R.A)(A,$,F,!1,null,"0afa56d4",null),D=P.exports,U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"offline-container"},[t("h2",[e._v("离线未上传数据")]),t("div",{staticClass:"actions"},[t("el-button",{attrs:{type:"primary",disabled:!e.isOnline||0===e.records.length},on:{click:e.uploadAll}},[e._v(" "+e._s(e.isOnline?"一键上传所有":"请连接网络后上传")+" ")]),t("el-button",{attrs:{type:"danger",disabled:0===e.records.length},on:{click:e.clearAll}},[e._v("清空本地数据")]),t("el-button",{attrs:{icon:"el-icon-refresh",circle:""},on:{click:e.loadRecords}})],1),t("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.records,border:""}},[t("el-table-column",{attrs:{prop:"projectName",label:"项目名称"}}),t("el-table-column",{attrs:{prop:"stage",label:"所处阶段"}}),t("el-table-column",{attrs:{prop:"processName",label:"工序名称"}}),t("el-table-column",{attrs:{prop:"status",label:"状态"}}),t("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{size:"mini",type:"success",disabled:!e.isOnline},on:{click:function(t){return e.uploadItem(s.row)}}},[e._v("上传")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteItem(s.row)}}},[e._v("删除")])]}}])})],1)],1)},B=[],z={name:"OfflineData",data(){return{records:[]}},computed:{...(0,a.L8)(["isOnline"])},created(){this.loadRecords()},methods:{async loadRecords(){this.records=await h()},async uploadAll(){if(!this.isOnline)return;const e=this.records.length;let t=0;for(const r of this.records)try{await this.mockUpload(r),await v(r._offlineId),t++}catch(s){console.error(s)}this.$message.success(`成功上传 ${t}/${e} 条数据`),this.loadRecords()},async uploadItem(e){if(this.isOnline)try{await E(e),await v(e._offlineId),this.$message.success("上传成功"),this.loadRecords()}catch(t){this.$message.error("上传失败")}},async deleteItem(e){try{await v(e._offlineId),this.$message.success("删除成功"),this.loadRecords()}catch(t){this.$message.error("删除失败")}},async clearAll(){try{await this.$confirm("确认清空所有本地数据吗？此操作不可恢复。","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await g(),this.$message.success("已清空"),this.loadRecords()}catch(e){"cancel"!==e?this.$message.error("清空失败"):this.$message.info("已取消清空")}}}},M=z,q=(0,R.A)(M,U,B,!1,null,"2c077864",null),G=q.exports;r["default"].use(N.Ay);const J=[{path:"/",redirect:"/submission"},{path:"/submission",name:"Submission",component:D},{path:"/offline",name:"OfflineData",component:G}],Q=new N.Ay({mode:"history",base:"/",routes:J});var H=Q;r["default"].use(a.Ay);var W=new a.Ay.Store({state:{isOnline:navigator.onLine,processList:[]},getters:{isOnline:e=>e.isOnline,processList:e=>e.processList},mutations:{SET_ONLINE_STATUS(e,t){e.isOnline=t},SET_PROCESS_LIST(e,t){e.processList=t}},actions:{updateOnlineStatus({commit:e},t){e("SET_ONLINE_STATUS",t)},async fetchProcessList({commit:e,state:t}){if(t.isOnline)try{const t=await S(),s=t.accessToken,r=await _(s),n=k(r);return e("SET_PROCESS_LIST",n),await f(n),n}catch(s){console.error("Error fetching process list online, trying cache:",s);const t=await m();if(t)return e("SET_PROCESS_LIST",t),t}else{const t=await m();if(t)return e("SET_PROCESS_LIST",t),t}return[]}},modules:{}}),Y=s(9143),Z=s.n(Y);r["default"].use(Z()),r["default"].config.productionTip=!1,new r["default"]({router:H,store:W,render:e=>e(C)}).$mount("#app")}},t={};function s(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,r,n,o){if(!r){var a=1/0;for(u=0;u<e.length;u++){r=e[u][0],n=e[u][1],o=e[u][2];for(var i=!0,c=0;c<r.length;c++)(!1&o||a>=o)&&Object.keys(s.O).every(function(e){return s.O[e](r[c])})?r.splice(c--,1):(i=!1,o<a&&(a=o));if(i){e.splice(u--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,n,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,r){var n,o,a=r[0],i=r[1],c=r[2],l=0;if(a.some(function(t){return 0!==e[t]})){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(c)var u=c(s)}for(t&&t(r);l<a.length;l++)o=a[l],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(u)},r=self["webpackChunkprojectmanagement"]=self["webpackChunkprojectmanagement"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=s.O(void 0,[504],function(){return s(614)});r=s.O(r)})();
//# sourceMappingURL=app.193766b5.js.map